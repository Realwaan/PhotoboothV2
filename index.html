<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Missing Alegres</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* Top Banner */
        .top-banner {
            background: #ffc0cb;
            text-align: center;
            padding: 12px;
            font-size: 13px;
            color: #666;
        }

        /* Navigation */
        nav {
            background: white;
            padding: 20px 50px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .nav-links {
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #666;
            font-size: 14px;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #ff69b4;
        }

        .nav-links a.active {
            color: #ff69b4;
            font-weight: 600;
        }

        /* Landing Page */
        .landing-page {
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 50%, #ffc0cb 100%);
            min-height: calc(100vh - 100px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 60px 20px;
            position: relative;
            overflow: hidden;
        }

        .spotlight-banner {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 30px;
            border-radius: 50px;
            margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 600px;
        }

        .spotlight-banner .new-badge {
            display: inline-block;
            background: white;
            border: 2px solid #ff69b4;
            border-radius: 50%;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 12px;
            color: #ff69b4;
            margin-right: 15px;
        }

        .spotlight-banner .spotlight-text {
            color: #666;
            font-size: 14px;
        }

        .spotlight-banner .highlight {
            color: #ff69b4;
            font-weight: bold;
        }

        .hero-content {
            text-align: center;
            z-index: 2;
        }

        .hero-title {
            font-size: 80px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            letter-spacing: -2px;
        }

        .hero-subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }

        .hero-tagline {
            font-size: 16px;
            color: #888;
            font-style: italic;
            margin-bottom: 40px;
        }

        .year-badges {
            display: flex;
            gap: 40px;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
        }

        .year-badge {
            font-size: 18px;
            color: #666;
            font-weight: 600;
        }

        .start-button {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
            border: none;
            padding: 18px 60px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(255, 105, 180, 0.4);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(255, 105, 180, 0.5);
        }

        /* Sample Photos */
        .sample-photos {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .photo-strip {
            position: absolute;
            width: 200px;
            transform: rotate(-15deg);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }

        .photo-strip.left {
            left: 10%;
            top: 25%;
            animation: float 6s ease-in-out infinite;
        }

        .photo-strip.right {
            right: 10%;
            top: 25%;
            transform: rotate(15deg);
            animation: float 6s ease-in-out infinite 1s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-15deg); }
            50% { transform: translateY(-20px) rotate(-15deg); }
        }

        .photo-strip.right {
            animation-name: floatRight;
        }

        @keyframes floatRight {
            0%, 100% { transform: translateY(0) rotate(15deg); }
            50% { transform: translateY(-20px) rotate(15deg); }
        }

        /* Photobooth App (hidden initially) */
        .photobooth-container {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
            margin: 40px auto;
        }

        .photobooth-container.active {
            display: block;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .back-button {
            background: #f0f0f0;
            color: #666;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .back-button:hover {
            background: #e0e0e0;
        }

        .camera-section {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            aspect-ratio: 4/3;
        }

        #video {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
        }

        #canvas {
            display: none;
        }

        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 120px;
            color: white;
            font-weight: bold;
            z-index: 10;
        }

        .countdown-overlay.active {
            display: flex;
        }

        .flash-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 20;
        }

        .flash-effect.active {
            animation: flash 0.3s ease-out;
        }

        @keyframes flash {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        .layout-selector {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 15px;
        }

        .layout-selector h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .layout-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }

        .layout-option {
            position: relative;
            cursor: pointer;
            border: 3px solid #ddd;
            border-radius: 10px;
            padding: 10px;
            background: white;
            transition: all 0.3s ease;
        }

        .layout-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .layout-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .layout-option input[type="radio"]:checked ~ .layout-preview {
            border-color: #667eea;
            background: #f0e7ff;
        }

        .layout-option input[type="radio"]:checked ~ label {
            color: #667eea;
            font-weight: bold;
        }

        .layout-option.selected {
            border-color: #667eea;
            background: #f9f6ff;
        }

        .layout-preview {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 8px;
            background: #f5f5f5;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 3px;
            transition: all 0.3s ease;
        }

        .layout-preview-box {
            background: #667eea;
            border-radius: 3px;
        }

        .layout-a .layout-preview-box {
            width: 80%;
            height: 25px;
        }

        .layout-b .layout-preview {
            flex-direction: row;
            flex-wrap: wrap;
        }

        .layout-b .layout-preview-box {
            width: 48%;
            height: 45px;
        }

        .layout-c .layout-preview-box {
            width: 80%;
            height: 45px;
        }

        .layout-d .layout-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3px;
        }

        .layout-d .layout-preview-box {
            width: 100%;
            height: 35px;
        }

        .layout-d .layout-preview-box:nth-child(5),
        .layout-d .layout-preview-box:nth-child(6) {
            grid-column: span 1;
        }

        .layout-option label {
            display: block;
            font-size: 13px;
            color: #666;
            font-weight: 500;
            cursor: pointer;
        }

        .layout-note {
            font-size: 11px;
            color: #999;
            margin-top: 3px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #e0e0e0;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .photo-count {
            text-align: center;
            font-size: 18px;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .photo-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            aspect-ratio: 4/3;
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .photo-number {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: rgba(255, 0, 0, 1);
            transform: scale(1.1);
        }

        .message {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .message.error {
            background: #fee;
            color: #c33;
            border-left: 4px solid #c33;
        }

        .message.success {
            background: #efe;
            color: #3c3;
            border-left: 4px solid #3c3;
        }

        .message.info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #1976d2;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 24px;
            }

            .hero-title {
                font-size: 48px;
            }

            .nav-links {
                display: none;
            }

            .controls {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .photos-grid {
                grid-template-columns: 1fr;
            }

            .photo-strip {
                width: 150px;
            }

            .year-badges {
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Top Banner -->
    <div class="top-banner">
        Share your photos and don't forget to tag us @andrei.regulacion13
    </div>

    <!-- Navigation -->
    <nav>
        <div class="logo">missing alegres</div>
        <div class="nav-links">
            <a href="#" class="active">home</a>
            <a href="#" onclick="showPhotobooth()">choose layout</a>
        </div>
    </nav>

    <!-- Landing Page -->
    <div class="landing-page" id="landingPage">
        <div class="sample-photos">
            <!-- Left photo strip -->
            <div class="photo-strip left">
                <svg width="200" height="400" viewBox="0 0 200 400">
                    <rect width="200" height="400" fill="white" rx="10"/>
                    <rect x="10" y="10" width="180" height="120" fill="#ffc0cb" rx="5"/>
                    <rect x="10" y="140" width="180" height="120" fill="#ffb6c1" rx="5"/>
                    <rect x="10" y="270" width="180" height="120" fill="#ffc0cb" rx="5"/>
                    <text x="100" y="380" text-anchor="middle" font-size="12" fill="#666">@andrei.regulacion13</text>
                </svg>
            </div>

            <!-- Right photo strip -->
            <div class="photo-strip right">
                <svg width="200" height="400" viewBox="0 0 200 400">
                    <rect width="200" height="400" fill="#333" rx="10"/>
                    <rect x="10" y="10" width="180" height="120" fill="#555" rx="5"/>
                    <rect x="10" y="140" width="180" height="120" fill="#666" rx="5"/>
                    <rect x="10" y="270" width="180" height="120" fill="#555" rx="5"/>
                    <text x="100" y="380" text-anchor="middle" font-size="12" fill="#fff">@andrei.regulacion13</text>
                </svg>
            </div>
        </div>

        <div class="hero-content">
            <div class="year-badges">
                <span class="year-badge">EST</span>
                <h1 class="hero-title">missing alegres</h1>
                <span class="year-badge">2025</span>
            </div>
            <p class="hero-subtitle">Capture the moment, cherish the magic,</p>
            <p class="hero-tagline">relive the love</p>
            <button class="start-button" onclick="showPhotobooth()">START 📸</button>
        </div>
    </div>

    <!-- Photobooth App Container -->
    <div class="photobooth-container" id="photoboothApp">
        <button class="back-button" onclick="showLanding()">← Back to Home</button>
        <h1>📸 Missing Alegres</h1>
        <p class="subtitle">Capture 3 amazing photos!</p>

        <div id="messageContainer"></div>

        <div class="photo-count" id="photoCount">Photos captured: 0 / 3</div>

        <div class="camera-section">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas"></canvas>
            <div class="countdown-overlay" id="countdown"></div>
            <div class="flash-effect" id="flash"></div>
        </div>

        <div class="layout-selector">
            <h3>📐 Choose Your Layout</h3>
            <p class="subtitle" style="margin-bottom: 15px;">Select how you want your photos arranged</p>
            
            <div class="layout-options">
                <div class="layout-option layout-a">
                    <input type="radio" name="layout" value="layoutA" id="layoutA" checked>
                    <div class="layout-preview">
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                    </div>
                    <label for="layoutA">Layout A</label>
                    <div class="layout-note">3 photos vertical</div>
                </div>

                <div class="layout-option layout-b">
                    <input type="radio" name="layout" value="layoutB" id="layoutB">
                    <div class="layout-preview">
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                    </div>
                    <label for="layoutB">Layout B</label>
                    <div class="layout-note">4 photos - 2x2 grid</div>
                </div>

                <div class="layout-option layout-c">
                    <input type="radio" name="layout" value="layoutC" id="layoutC">
                    <div class="layout-preview">
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                    </div>
                    <label for="layoutC">Layout C</label>
                    <div class="layout-note">2 photos large</div>
                </div>

                <div class="layout-option layout-d">
                    <input type="radio" name="layout" value="layoutD" id="layoutD">
                    <div class="layout-preview">
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                    </div>
                    <label for="layoutD">Layout D</label>
                    <div class="layout-note">6 photos mixed</div>
                </div>

                <div class="layout-option">
                    <input type="radio" name="layout" value="horizontal" id="layoutHorizontal">
                    <div class="layout-preview" style="flex-direction: row;">
                        <div class="layout-preview-box" style="width: 30%; height: 60px;"></div>
                        <div class="layout-preview-box" style="width: 30%; height: 60px;"></div>
                        <div class="layout-preview-box" style="width: 30%; height: 60px;"></div>
                    </div>
                    <label for="layoutHorizontal">Horizontal</label>
                    <div class="layout-note">3 photos side by side</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-primary" id="startBtn" onclick="startCamera()">Start Camera</button>
            <button class="btn-primary" id="captureBtn" onclick="capturePhoto()" disabled>Take Photo (3 sec)</button>
            <button class="btn-secondary" id="resetBtn" onclick="resetPhotos()" disabled>Reset All</button>
            <button class="btn-success" id="downloadBtn" onclick="downloadStrip()" disabled>Download Photo Strip</button>
        </div>

        <div class="photos-grid" id="photosGrid"></div>
    </div>

    <script>
        let stream = null;
        let photos = [];
        let maxPhotos = 3; // Will be updated based on layout
        let countdownInterval = null;

        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const captureBtn = document.getElementById('captureBtn');
        const resetBtn = document.getElementById('resetBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const photosGrid = document.getElementById('photosGrid');
        const photoCount = document.getElementById('photoCount');
        const messageContainer = document.getElementById('messageContainer');
        const countdownOverlay = document.getElementById('countdown');
        const flashEffect = document.getElementById('flash');

        // Layout photo requirements
        const layoutRequirements = {
            'layoutA': 3,
            'layoutB': 4,
            'layoutC': 2,
            'layoutD': 6,
            'horizontal': 3
        };

        // Get required photos for current layout
        function getRequiredPhotos() {
            const layout = document.querySelector('input[name="layout"]:checked')?.value || 'layoutA';
            return layoutRequirements[layout] || 3;
        }

        // Update photo count display
        function updatePhotoCountDisplay() {
            maxPhotos = getRequiredPhotos();
            photoCount.textContent = `Photos captured: ${photos.length} / ${maxPhotos}`;
        }

        // Page Navigation Functions
        function showPhotobooth() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('photoboothApp').classList.add('active');
            document.querySelector('nav').style.display = 'none';
            document.querySelector('.top-banner').style.display = 'none';
        }

        function showLanding() {
            document.getElementById('landingPage').style.display = 'flex';
            document.getElementById('photoboothApp').classList.remove('active');
            document.querySelector('nav').style.display = 'flex';
            document.querySelector('.top-banner').style.display = 'block';
            
            // Stop camera if active
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                video.srcObject = null;
                startBtn.disabled = false;
                captureBtn.disabled = true;
            }
        }

        function showMessage(message, type = 'info') {
            messageContainer.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                messageContainer.innerHTML = '';
            }, 5000);
        }

        // Layout Selection Handler
        document.addEventListener('DOMContentLoaded', function() {
            const layoutOptions = document.querySelectorAll('.layout-option');
            
            layoutOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    layoutOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Check the radio button inside
                    const radio = this.querySelector('input[type="radio"]');
                    if (radio) {
                        radio.checked = true;
                        updatePhotoCountDisplay();
                        
                        // Update capture button state
                        const requiredPhotos = getRequiredPhotos();
                        if (photos.length >= requiredPhotos) {
                            captureBtn.disabled = true;
                            downloadBtn.disabled = false;
                            showMessage(`You have enough photos for this layout! (${photos.length}/${requiredPhotos})`, 'success');
                        } else if (photos.length > 0) {
                            captureBtn.disabled = false;
                            downloadBtn.disabled = true;
                            showMessage(`Layout changed! You need ${requiredPhotos - photos.length} more photo(s).`, 'info');
                        }
                    }
                });
            });
            
            // Initialize with default layout
            updatePhotoCountDisplay();
        });

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }, 
                    audio: false 
                });
                
                video.srcObject = stream;
                startBtn.disabled = true;
                captureBtn.disabled = false;
                showMessage('Camera started! Click "Take Photo" to capture.', 'success');
            } catch (error) {
                console.error('Error accessing camera:', error);
                showMessage('Error: Could not access camera. Please allow camera permissions.', 'error');
            }
        }

        function capturePhoto() {
            const requiredPhotos = getRequiredPhotos();
            if (photos.length >= requiredPhotos) {
                showMessage(`You already have ${requiredPhotos} photos! Reset to take more.`, 'info');
                return;
            }

            captureBtn.disabled = true;
            startCountdown();
        }

        function startCountdown() {
            let count = 3;
            countdownOverlay.textContent = count;
            countdownOverlay.classList.add('active');

            countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownOverlay.textContent = count;
                } else {
                    clearInterval(countdownInterval);
                    countdownOverlay.classList.remove('active');
                    takeSnapshot();
                }
            }, 1000);
        }

        function takeSnapshot() {
            // Flash effect
            flashEffect.classList.add('active');
            setTimeout(() => {
                flashEffect.classList.remove('active');
            }, 300);

            // Set canvas size to match video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            // Draw the video frame to canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Get image data
            const imageData = canvas.toDataURL('image/png');
            photos.push(imageData);

            // Update UI
            updatePhotosDisplay();
            updatePhotoCountDisplay();

            const requiredPhotos = getRequiredPhotos();
            if (photos.length >= requiredPhotos) {
                captureBtn.disabled = true;
                downloadBtn.disabled = false;
                showMessage(`All ${requiredPhotos} photos captured! You can download your photo strip now.`, 'success');
            } else {
                captureBtn.disabled = false;
                showMessage(`Photo ${photos.length} captured! ${requiredPhotos - photos.length} more to go.`, 'success');
            }

            resetBtn.disabled = false;
        }

        function updatePhotosDisplay() {
            photosGrid.innerHTML = '';
            photos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                photoItem.innerHTML = `
                    <img src="${photo}" alt="Photo ${index + 1}">
                    <div class="photo-number">${index + 1}</div>
                    <button class="delete-btn" onclick="deletePhoto(${index})">×</button>
                `;
                photosGrid.appendChild(photoItem);
            });
        }

        function deletePhoto(index) {
            photos.splice(index, 1);
            updatePhotosDisplay();
            updatePhotoCountDisplay();

            const requiredPhotos = getRequiredPhotos();
            if (photos.length < requiredPhotos) {
                captureBtn.disabled = false;
                downloadBtn.disabled = photos.length === 0;
            }

            if (photos.length === 0) {
                resetBtn.disabled = true;
            }

            showMessage(`Photo ${index + 1} deleted.`, 'info');
        }

        function resetPhotos() {
            if (confirm('Are you sure you want to delete all photos?')) {
                photos = [];
                updatePhotosDisplay();
                updatePhotoCountDisplay();
                captureBtn.disabled = false;
                resetBtn.disabled = true;
                downloadBtn.disabled = true;
                showMessage('All photos reset. Start capturing new ones!', 'info');
            }
        }

        function downloadStrip() {
            if (photos.length === 0) {
                showMessage('No photos to download!', 'error');
                return;
            }

            // Get selected layout
            const layout = document.querySelector('input[name="layout"]:checked').value;

            // Create a canvas for the photo strip
            const stripCanvas = document.createElement('canvas');
            const stripCtx = stripCanvas.getContext('2d');

            // Set dimensions based on layout
            const photoWidth = 500;
            const photoHeight = 375;
            const padding = 30;
            const photoPadding = 15;
            const headerSize = 100;
            const footerSize = 60;
            const borderWidth = 40;

            // Calculate canvas size based on layout
            if (layout === 'layoutA') {
                // 3 photos vertical
                stripCanvas.width = photoWidth + (padding * 2) + (borderWidth * 2);
                stripCanvas.height = (photoHeight * 3) + (photoPadding * 2) + (padding * 2) + headerSize + footerSize + (borderWidth * 2);
            } else if (layout === 'layoutB') {
                // 2x2 grid (4 photos)
                stripCanvas.width = (photoWidth * 2) + photoPadding + (padding * 2) + (borderWidth * 2);
                stripCanvas.height = (photoHeight * 2) + photoPadding + (padding * 2) + headerSize + footerSize + (borderWidth * 2);
            } else if (layout === 'layoutC') {
                // 2 photos large vertical
                stripCanvas.width = photoWidth + (padding * 2) + (borderWidth * 2);
                stripCanvas.height = (photoHeight * 2) + photoPadding + (padding * 2) + headerSize + footerSize + (borderWidth * 2);
            } else if (layout === 'layoutD') {
                // Mixed layout (collage style)
                stripCanvas.width = (photoWidth * 2) + photoPadding + (padding * 2) + (borderWidth * 2);
                stripCanvas.height = (photoHeight * 2) + photoPadding + (padding * 2) + headerSize + footerSize + (borderWidth * 2);
            } else {
                // Horizontal layout
                stripCanvas.width = (photoWidth * 3) + (photoPadding * 2) + (padding * 2) + headerSize + footerSize + (borderWidth * 2);
                stripCanvas.height = photoHeight + (padding * 2) + (borderWidth * 2);
            }

            // Purple aesthetic gradient background
            const gradient = (layout === 'horizontal')
                ? stripCtx.createLinearGradient(0, 0, stripCanvas.width, 0)
                : stripCtx.createLinearGradient(0, 0, 0, stripCanvas.height);
            gradient.addColorStop(0, '#e0c3fc');
            gradient.addColorStop(0.33, '#c3a6f5');
            gradient.addColorStop(0.66, '#a78bfa');
            gradient.addColorStop(1, '#8b5cf6');
            stripCtx.fillStyle = gradient;
            stripCtx.fillRect(0, 0, stripCanvas.width, stripCanvas.height);

            // Outer border
            stripCtx.strokeStyle = '#ffffff';
            stripCtx.lineWidth = borderWidth;
            stripCtx.strokeRect(borderWidth / 2, borderWidth / 2, stripCanvas.width - borderWidth, stripCanvas.height - borderWidth);

            // Decorative corner elements
            const cornerSize = 30;
            stripCtx.fillStyle = '#ffffff';
            // Top left
            stripCtx.fillRect(borderWidth, borderWidth, cornerSize, 5);
            stripCtx.fillRect(borderWidth, borderWidth, 5, cornerSize);
            // Top right
            stripCtx.fillRect(stripCanvas.width - borderWidth - cornerSize, borderWidth, cornerSize, 5);
            stripCtx.fillRect(stripCanvas.width - borderWidth - 5, borderWidth, 5, cornerSize);
            // Bottom left
            stripCtx.fillRect(borderWidth, stripCanvas.height - borderWidth - 5, cornerSize, 5);
            stripCtx.fillRect(borderWidth, stripCanvas.height - borderWidth - cornerSize, 5, cornerSize);
            // Bottom right
            stripCtx.fillRect(stripCanvas.width - borderWidth - cornerSize, stripCanvas.height - borderWidth - 5, cornerSize, 5);
            stripCtx.fillRect(stripCanvas.width - borderWidth - 5, stripCanvas.height - borderWidth - cornerSize, 5, cornerSize);

            const date = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            // Draw header for all layouts
            function drawHeader(x, y, centered = true) {
                stripCtx.fillStyle = '#ffffff';
                stripCtx.font = 'bold 40px Arial';
                stripCtx.textAlign = centered ? 'center' : 'left';
                stripCtx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                stripCtx.shadowBlur = 8;
                stripCtx.shadowOffsetX = 2;
                stripCtx.shadowOffsetY = 2;
                stripCtx.fillText('💜 Memories 💜', x, y);

                stripCtx.shadowBlur = 0;
                stripCtx.shadowOffsetX = 0;
                stripCtx.shadowOffsetY = 0;
                stripCtx.font = '16px Arial';
                stripCtx.fillText(date, x, y + 25);
            }

            // Draw footer for all layouts
            function drawFooter(x, y, centered = true) {
                stripCtx.fillStyle = '#ffffff';
                stripCtx.font = '14px Arial';
                stripCtx.textAlign = centered ? 'center' : 'left';
                stripCtx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                stripCtx.shadowBlur = 5;
                stripCtx.fillText('Made with 💜 in Photo Booth', x, y);
            }

            // Draw photo with polaroid frame
            function drawPhotoWithFrame(img, x, y, width, height, number) {
                // White polaroid frame
                stripCtx.fillStyle = '#ffffff';
                stripCtx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                stripCtx.shadowBlur = 15;
                stripCtx.shadowOffsetX = 0;
                stripCtx.shadowOffsetY = 5;
                stripCtx.fillRect(x - 12, y - 12, width + 24, height + 40);

                // Reset shadow
                stripCtx.shadowBlur = 0;
                stripCtx.shadowOffsetX = 0;
                stripCtx.shadowOffsetY = 0;

                // Draw photo
                stripCtx.drawImage(img, x, y, width, height);

                // Photo number
                stripCtx.fillStyle = '#666';
                stripCtx.font = 'italic 16px Arial';
                stripCtx.textAlign = 'center';
                stripCtx.fillText(`Photo ${number}`, x + width / 2, y + height + 25);

                // Heart decoration
                stripCtx.fillStyle = '#a18cd1';
                stripCtx.font = '14px Arial';
                stripCtx.fillText('💜', x + width - 15, y + height + 25);
            }

            if (layout === 'layoutA') {
                // LAYOUT A: 3 photos vertical
                drawHeader(stripCanvas.width / 2, borderWidth + 50);
                
                const startY = borderWidth + headerSize;
                photos.slice(0, 3).forEach((photo, index) => {
                    const img = new Image();
                    img.src = photo;
                    const y = startY + (index * (photoHeight + photoPadding));
                    const x = borderWidth + padding;
                    drawPhotoWithFrame(img, x, y, photoWidth, photoHeight, index + 1);
                });

                const footerY = borderWidth + headerSize + (photoHeight * 3) + (photoPadding * 2) + padding + 20;
                drawFooter(stripCanvas.width / 2, footerY);

            } else if (layout === 'layoutB') {
                // LAYOUT B: 2x2 grid (4 photos)
                drawHeader(stripCanvas.width / 2, borderWidth + 50);
                
                const startY = borderWidth + headerSize;
                const startX = borderWidth + padding;
                const smallWidth = (photoWidth * 2 + photoPadding) / 2 - photoPadding / 2;
                const smallHeight = (photoHeight * 2 + photoPadding) / 2 - photoPadding / 2;

                // Draw all 4 photos in 2x2 grid
                for (let row = 0; row < 2; row++) {
                    for (let col = 0; col < 2; col++) {
                        const photoIndex = row * 2 + col;
                        if (photoIndex < photos.length) {
                            const img = new Image();
                            img.src = photos[photoIndex];
                            const x = startX + (col * (smallWidth + photoPadding));
                            const y = startY + (row * (smallHeight + photoPadding));
                            drawPhotoWithFrame(img, x, y, smallWidth, smallHeight, photoIndex + 1);
                        }
                    }
                }

                const footerY = startY + (smallHeight * 2) + photoPadding + 50;
                drawFooter(stripCanvas.width / 2, footerY);

            } else if (layout === 'layoutC') {
                // LAYOUT C: 2 large photos vertical
                drawHeader(stripCanvas.width / 2, borderWidth + 50);
                
                const startY = borderWidth + headerSize;
                photos.slice(0, 2).forEach((photo, index) => {
                    const img = new Image();
                    img.src = photo;
                    const y = startY + (index * (photoHeight + photoPadding));
                    const x = borderWidth + padding;
                    drawPhotoWithFrame(img, x, y, photoWidth, photoHeight, index + 1);
                });

                const footerY = borderWidth + headerSize + (photoHeight * 2) + photoPadding + 20;
                drawFooter(stripCanvas.width / 2, footerY);

            } else if (layout === 'layoutD') {
                // LAYOUT D: Mixed/collage (6 photos - 2 large top, 4 small bottom)
                drawHeader(stripCanvas.width / 2, borderWidth + 50);
                
                const startY = borderWidth + headerSize;
                const startX = borderWidth + padding;
                const largeWidth = (photoWidth * 2 + photoPadding) / 2 - photoPadding / 2;
                const largeHeight = photoHeight;
                const smallWidth = largeWidth / 2 - photoPadding / 2;
                const smallHeight = photoHeight / 2 - photoPadding / 2;

                // Top: 2 large photos side by side
                for (let i = 0; i < 2 && i < photos.length; i++) {
                    const img = new Image();
                    img.src = photos[i];
                    const x = startX + (i * (largeWidth + photoPadding));
                    drawPhotoWithFrame(img, x, startY, largeWidth, largeHeight, i + 1);
                }

                // Bottom: Grid of 4 smaller photos
                const bottomY = startY + largeHeight + photoPadding;
                for (let row = 0; row < 2; row++) {
                    for (let col = 0; col < 2; col++) {
                        const photoIndex = 2 + (row * 2) + col;
                        if (photoIndex < photos.length) {
                            const img = new Image();
                            img.src = photos[photoIndex];
                            const x = startX + (col * (smallWidth + photoPadding));
                            const y = bottomY + (row * (smallHeight + photoPadding));
                            
                            stripCtx.fillStyle = '#ffffff';
                            stripCtx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                            stripCtx.shadowBlur = 10;
                            stripCtx.fillRect(x - 8, y - 8, smallWidth + 16, smallHeight + 16);
                            stripCtx.shadowBlur = 0;
                            stripCtx.drawImage(img, x, y, smallWidth, smallHeight);
                            
                            // Add photo number
                            stripCtx.fillStyle = '#666';
                            stripCtx.font = 'italic 12px Arial';
                            stripCtx.textAlign = 'center';
                            stripCtx.fillText(`${photoIndex + 1}`, x + smallWidth / 2, y + smallHeight - 10);
                        }
                    }
                }

                const footerY = bottomY + (smallHeight * 2) + photoPadding + 30;
                drawFooter(stripCanvas.width / 2, footerY);

            } else {
                // HORIZONTAL LAYOUT
                const headerX = borderWidth + 20;
                
                // Save context for vertical text
                stripCtx.save();
                stripCtx.translate(headerX + 50, stripCanvas.height / 2);
                stripCtx.rotate(-Math.PI / 2);
                
                // Title
                stripCtx.fillStyle = '#ffffff';
                stripCtx.font = 'bold 48px Arial';
                stripCtx.textAlign = 'center';
                stripCtx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                stripCtx.shadowBlur = 10;
                stripCtx.shadowOffsetX = 2;
                stripCtx.shadowOffsetY = 2;
                stripCtx.fillText('💜 Memories 💜', 0, 0);

                // Date
                stripCtx.shadowBlur = 0;
                stripCtx.shadowOffsetX = 0;
                stripCtx.shadowOffsetY = 0;
                stripCtx.font = '20px Arial';
                stripCtx.fillText(date, 0, 35);
                
                stripCtx.restore();

                // Draw photos horizontally
                const startX = borderWidth + headerSize;
                photos.forEach((photo, index) => {
                    const img = new Image();
                    img.src = photo;
                    const x = startX + (index * (photoWidth + photoPadding));
                    const y = borderWidth + padding;

                    // White polaroid frame
                    stripCtx.fillStyle = '#ffffff';
                    stripCtx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    stripCtx.shadowBlur = 15;
                    stripCtx.shadowOffsetX = 0;
                    stripCtx.shadowOffsetY = 5;
                    stripCtx.fillRect(x - 15, y - 15, photoWidth + 30, photoHeight + 50);

                    // Reset shadow for photo
                    stripCtx.shadowBlur = 0;
                    stripCtx.shadowOffsetX = 0;
                    stripCtx.shadowOffsetY = 0;

                    // Draw photo
                    stripCtx.drawImage(img, x, y, photoWidth, photoHeight);

                    // Photo number in polaroid bottom space
                    stripCtx.fillStyle = '#666';
                    stripCtx.font = 'italic 18px Arial';
                    stripCtx.textAlign = 'center';
                    stripCtx.fillText(`Photo ${index + 1}`, x + photoWidth / 2, y + photoHeight + 30);

                    // Add small heart decoration
                    stripCtx.fillStyle = '#a18cd1';
                    stripCtx.font = '16px Arial';
                    stripCtx.fillText('💜', x + photoWidth - 20, y + photoHeight + 30);
                });

                // Footer section (vertical on right side)
                const footerX = borderWidth + headerSize + (photoWidth * photos.length) + (photoPadding * (photos.length - 1)) + padding + 30;
                
                stripCtx.save();
                stripCtx.translate(footerX + 35, stripCanvas.height / 2);
                stripCtx.rotate(-Math.PI / 2);
                
                // Footer text
                stripCtx.fillStyle = '#ffffff';
                stripCtx.font = '16px Arial';
                stripCtx.textAlign = 'center';
                stripCtx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                stripCtx.shadowBlur = 5;
                stripCtx.fillText('Made with 💜', 0, 0);
                
                stripCtx.restore();
            }

            // Download
            setTimeout(() => {
                const link = document.createElement('a');
                link.download = `purple-photobooth-${layout}-${Date.now()}.png`;
                link.href = stripCanvas.toDataURL('image/png');
                link.click();
                showMessage(`Purple photo strip (${layout}) downloaded successfully! 💜`, 'success');
            }, 100);
        }

        // Stop camera when page is closed
        window.addEventListener('beforeunload', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html>
