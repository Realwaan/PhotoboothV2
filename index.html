<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>Missing Alegres</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* Top Banner */
        .top-banner {
            background: #ffc0cb;
            text-align: center;
            padding: 12px;
            font-size: 13px;
            color: #666;
        }

        /* Navigation */
        nav {
            background: white;
            padding: 20px 50px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .nav-links {
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #666;
            font-size: 14px;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #ff69b4;
        }

        .nav-links a.active {
            color: #ff69b4;
            font-weight: 600;
        }

        /* Landing Page */
        .landing-page {
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 50%, #ffc0cb 100%);
            min-height: calc(100vh - 100px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 60px 20px;
            position: relative;
            overflow: hidden;
        }

        .spotlight-banner {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 30px;
            border-radius: 50px;
            margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 600px;
        }

        .spotlight-banner .new-badge {
            display: inline-block;
            background: white;
            border: 2px solid #ff69b4;
            border-radius: 50%;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 12px;
            color: #ff69b4;
            margin-right: 15px;
        }

        .spotlight-banner .spotlight-text {
            color: #666;
            font-size: 14px;
        }

        .spotlight-banner .highlight {
            color: #ff69b4;
            font-weight: bold;
        }

        .hero-content {
            text-align: center;
            z-index: 2;
        }

        .hero-title {
            font-size: 80px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            letter-spacing: -2px;
        }

        .hero-subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }

        .hero-tagline {
            font-size: 16px;
            color: #888;
            font-style: italic;
            margin-bottom: 40px;
        }

        .year-badges {
            display: flex;
            gap: 40px;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
        }

        .year-badge {
            font-size: 18px;
            color: #666;
            font-weight: 600;
        }

        .start-button {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
            border: none;
            padding: 20px 70px;
            font-size: 20px;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.45);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
        }

        .start-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .start-button:hover::before {
            left: 100%;
        }

        .start-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 105, 180, 0.6);
        }

        .start-button:active {
            transform: translateY(-2px) scale(1.03);
        }

        /* Sample Photos */
        .sample-photos {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .photo-strip {
            position: absolute;
            width: 220px;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .photo-strip .strip-photos {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .photo-strip .strip-box {
            width: 100%;
            height: 150px;
            border-radius: 8px;
            background-size: cover;
            background-position: center;
        }

        .photo-strip .strip-handle {
            text-align: center;
            margin-top: 10px;
            font-size: 11px;
            color: #999;
            font-family: 'Courier New', monospace;
        }

        .photo-strip.left {
            left: 10%;
            top: 25%;
            transform: rotate(-8deg);
            animation: float 6s ease-in-out infinite;
        }

        .photo-strip.right {
            right: 10%;
            top: 25%;
            transform: rotate(8deg);
            animation: floatRight 6s ease-in-out infinite 1s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-8deg); }
            50% { transform: translateY(-20px) rotate(-8deg); }
        }

        @keyframes floatRight {
            0%, 100% { transform: translateY(0) rotate(8deg); }
            50% { transform: translateY(-20px) rotate(8deg); }
        }

        /* Photobooth App (hidden initially) */
        .photobooth-container {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 95%;
            margin: 40px auto;
        }

        .photobooth-container.active {
            display: block;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 36px;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 15px;
        }

        .back-button {
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            color: #666;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 25px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .back-button:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Main Content Grid */
        .photobooth-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .left-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .selection-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .camera-section {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 0;
            aspect-ratio: 4/3;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        #video {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
            transform: scaleX(-1);
        }

        #canvas {
            display: none;
        }

        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 120px;
            color: white;
            font-weight: bold;
            z-index: 10;
        }

        .countdown-overlay.active {
            display: flex;
        }

        .flash-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 20;
        }

        .flash-effect.active {
            animation: flash 0.3s ease-out;
        }

        @keyframes flash {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        .layout-selector {
            text-align: center;
            margin-bottom: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f9f9f9 0%, #ffffff 100%);
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .layout-selector h3 {
            color: #333;
            margin-bottom: 12px;
            font-size: 18px;
            font-weight: 600;
        }

        .layout-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            max-width: 100%;
            margin: 0 auto;
        }

        .layout-option {
            position: relative;
            cursor: pointer;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            padding: 10px;
            background: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(102, 126, 234, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .layout-option:hover,
        .layout-option:active {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 6px 18px rgba(102, 126, 234, 0.25);
            border-color: #667eea;
        }

        .layout-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .layout-option input[type="radio"]:checked ~ .layout-preview {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0e7ff 0%, #fdf4ff 100%);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }

        .layout-option input[type="radio"]:checked ~ label {
            color: #667eea;
            font-weight: 700;
        }

        .layout-option.selected {
            border-color: #667eea;
            background: #fafbff;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.2);
        }

        .layout-preview {
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            padding: 8px;
            margin-bottom: 6px;
            background: #fafafa;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 3px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .layout-preview-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .layout-a .layout-preview-box {
            width: 70%;
            height: 18px;
        }

        .layout-b .layout-preview {
            flex-direction: row;
            flex-wrap: wrap;
        }

        .layout-b .layout-preview-box {
            width: 47%;
            height: 32px;
        }

        .layout-c .layout-preview-box {
            width: 70%;
            height: 32px;
        }

        .layout-d .layout-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3px;
        }

        .layout-d .layout-preview-box {
            width: 100%;
            height: 22px;
        }

        .layout-d .layout-preview-box:nth-child(5),
        .layout-d .layout-preview-box:nth-child(6) {
            grid-column: span 1;
        }

        /* Heart shape for layout preview */
        .heart-shape {
            width: 24px !important;
            height: 24px !important;
            position: relative;
            transform: rotate(-45deg);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        }

        .heart-shape::before,
        .heart-shape::after {
            content: "";
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .heart-shape::before {
            top: -12px;
            left: 0;
        }

        .heart-shape::after {
            left: 12px;
            top: 0;
        }

        .layout-option label {
            display: block;
            font-size: 12px;
            color: #555;
            font-weight: 600;
            cursor: pointer;
        }

        .layout-note {
            font-size: 10px;
            color: #999;
            margin-top: 3px;
            font-weight: 400;
        }

        /* Filter Selector */
        .filter-selector {
            text-align: center;
            margin-bottom: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f9f9f9 0%, #ffffff 100%);
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .filter-selector h3 {
            color: #333;
            margin-bottom: 12px;
            font-size: 18px;
            font-weight: 600;
        }

        .filter-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 100%;
            margin: 0 auto;
        }

        .filter-option {
            cursor: pointer;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            padding: 8px;
            background: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(102, 126, 234, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .filter-option:hover,
        .filter-option:active {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 18px rgba(102, 126, 234, 0.25);
            border-color: #667eea;
        }

        .filter-option.selected {
            border-color: #667eea;
            background: #fafbff;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
        }

        .filter-preview {
            width: 60px;
            height: 60px;
            margin: 0 auto 6px;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .filter-option label {
            display: block;
            font-size: 11px;
            color: #555;
            font-weight: 600;
            cursor: pointer;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 32px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.35);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.45);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(-1px) scale(1.01);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            color: #333;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .btn-secondary:hover:not(:disabled) {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(56, 239, 125, 0.35);
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(56, 239, 125, 0.45);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .photo-count {
            text-align: center;
            font-size: 18px;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .photo-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            aspect-ratio: 4/3;
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .photo-number {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: rgba(255, 0, 0, 1);
            transform: scale(1.1);
        }

        .message {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .message.error {
            background: #fee;
            color: #c33;
            border-left: 4px solid #c33;
        }

        .message.success {
            background: #efe;
            color: #3c3;
            border-left: 4px solid #3c3;
        }

        .message.info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #1976d2;
        }

        /* Preview Section */
        .preview-section {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 15px;
            text-align: center;
        }

        .preview-section.active {
            display: block;
        }

        .preview-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .preview-canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            overflow-x: auto;
            padding: 10px;
        }

        #previewCanvas {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            background: white;
        }

        /* Customization Section */
        .customize-section {
            display: none;
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #ffeef8 0%, #fff5f7 100%);
            border-radius: 20px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }

        .customize-section.active {
            display: block;
        }

        .customize-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 24px;
            text-align: center;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(102, 126, 234, 0.1);
        }

        .customize-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-top: 25px;
        }

        .customize-group {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .customize-group:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .customize-group h4 {
            color: #444;
            margin-bottom: 18px;
            font-size: 17px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .color-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .color-btn:hover {
            transform: scale(1.15);
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .color-btn.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2), 0 4px 12px rgba(102, 126, 234, 0.4);
            transform: scale(1.1);
        }

        .color-btn.selected::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 18px;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.6);
        }

        .shape-options {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .shape-btn {
            width: 65px;
            height: 65px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .shape-btn:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .shape-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f0ff 0%, #e8e8ff 100%);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15), 0 4px 12px rgba(102, 126, 234, 0.3);
            transform: scale(1.08);
        }

        .stickers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(55px, 1fr));
            gap: 12px;
            margin-top: 10px;
            max-height: 220px;
            overflow-y: auto;
            padding: 5px;
        }

        .sticker-btn {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        }

        .sticker-btn:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: scale(1.15);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .sticker-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f0ff 0%, #e8e8ff 100%);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15), 0 4px 10px rgba(102, 126, 234, 0.3);
            transform: scale(1.1);
        }

        .logo-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .logo-btn {
            padding: 10px 20px;
            background: #f5f5f5;
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .logo-btn:hover {
            background: #e8e8e8;
        }

        .logo-btn.selected {
            border-color: #667eea;
            background: #f0f0ff;
            font-weight: 600;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 14px;
            color: #555;
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .customize-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
        }

        .btn-retake {
            padding: 12px 30px;
            background: white;
            color: #ff6b9d;
            border: 2px solid #ff6b9d;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-retake:hover {
            background: #ff6b9d;
            color: white;
        }

        .btn-download {
            padding: 12px 30px;
            background: #ff6b9d;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-download:hover {
            background: #ff4c85;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.3);
        }

        @media (max-width: 768px) {
            body {
                font-size: 16px; /* Prevent zoom on input focus */
            }

            h1 {
                font-size: 24px;
                padding: 10px;
            }

            .hero-title {
                font-size: 36px;
                line-height: 1.2;
            }

            .hero-subtitle {
                font-size: 16px;
                padding: 0 15px;
            }

            .nav-links {
                display: none;
            }

            .photobooth-container {
                padding: 20px;
            }

            .photobooth-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .selection-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .container {
                padding: 15px;
                max-width: 100%;
            }

            .controls {
                flex-direction: column;
                gap: 10px;
            }

            button {
                width: 100%;
                min-height: 48px; /* Touch-friendly button size */
                font-size: 16px;
            }

            .photos-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .photo-strip {
                width: 120px;
            }

            .year-badges {
                gap: 15px;
                flex-wrap: wrap;
            }

            /* Camera section mobile optimization */
            #video {
                max-width: 100%;
                height: auto;
            }

            .video-container {
                width: 100%;
                max-width: 100%;
            }

            /* Filter options mobile */
            .filter-options {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            /* Layout selector mobile */
            .layout-options {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            /* Customize section mobile */
            .customize-section {
                padding: 15px;
            }

            .color-options {
                gap: 8px;
            }

            .color-btn {
                width: 35px;
                height: 35px;
                min-width: 35px;
                min-height: 35px;
            }

            .shape-options {
                gap: 10px;
                flex-wrap: wrap;
            }

            .shape-btn {
                width: 55px;
                height: 55px;
                font-size: 20px;
            }

            .stickers-grid {
                grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
                gap: 8px;
                max-height: 250px;
            }

            .sticker-btn {
                width: 45px;
                height: 45px;
                font-size: 24px;
            }

            .logo-options {
                flex-wrap: wrap;
                gap: 8px;
            }

            .logo-btn {
                padding: 10px 15px;
                font-size: 14px;
            }

            .customize-actions {
                flex-direction: column;
                gap: 10px;
            }

            .btn-retake,
            .btn-download {
                width: 100%;
                min-height: 48px;
                font-size: 16px;
            }

            /* Preview canvas mobile */
            .preview-canvas-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            #previewCanvas {
                max-width: 100%;
            }

            /* Top banner mobile */
            .top-banner {
                font-size: 12px;
                padding: 10px;
            }

            /* Sample photos on landing - hide on very small screens */
            .sample-photos {
                gap: 15px;
            }

            .photo-strip.left,
            .photo-strip.right {
                display: none;
            }
        }

        /* Extra small devices */
        @media (max-width: 480px) {
            .hero-title {
                font-size: 28px;
            }

            .color-btn {
                width: 30px;
                height: 30px;
            }

            .layout-options {
                grid-template-columns: 1fr;
            }

            .filter-options {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Top Banner -->
    <div class="top-banner">
        Share your photos and don't forget to tag us @andrei.regulacion13
    </div>

    <!-- Navigation -->
    <nav>
        <div class="logo">missing alegres</div>
        <div class="nav-links">
            <a href="#" class="active">home</a>
            <a href="#" onclick="showPhotobooth()">choose layout</a>
        </div>
    </nav>

    <!-- Landing Page -->
    <div class="landing-page" id="landingPage">
        <div class="sample-photos">
            <!-- Left photo strip -->
            <div class="photo-strip left">
                <div class="strip-photos">
                    <div class="strip-box" style="background-image: url('images/photo1.jpg'); background-color: #ffc0cb;"></div>
                    <div class="strip-box" style="background-image: url('images/photo2.jpg'); background-color: #ffb6c1;"></div>
                    <div class="strip-box" style="background-image: url('images/photo3.jpg'); background-color: #ffc0cb;"></div>
                </div>
                <div class="strip-handle">@andrei.regulacion13</div>
            </div>

            <!-- Right photo strip -->
            <div class="photo-strip right">
                <div class="strip-photos">
                    <div class="strip-box" style="background-image: url('images/photo4.jpg'); background-color: #555;"></div>
                    <div class="strip-box" style="background-image: url('images/photo5.jpg'); background-color: #666;"></div>
                    <div class="strip-box" style="background-image: url('images/photo6.jpg'); background-color: #555;"></div>
                </div>
                <div class="strip-handle">@andrei.regulacion13</div>
            </div>
        </div>

        <div class="hero-content">
            <div class="year-badges">
                <span class="year-badge">EST</span>
                <h1 class="hero-title">missing alegres</h1>
                <span class="year-badge">2025</span>
            </div>
            <p class="hero-subtitle">Capture the moment, cherish the magic,</p>
            <p class="hero-tagline">relive the love</p>
            <button class="start-button" onclick="showPhotobooth()">START üì∏</button>
        </div>
    </div>

    <!-- Photobooth App Container -->
    <div class="photobooth-container" id="photoboothApp">
        <button class="back-button" onclick="showLanding()">‚Üê Back to Home</button>
        <h1>üì∏ Missing Alegres</h1>
        <p class="subtitle">Capture amazing photos and customize your photostrip!</p>

        <div id="messageContainer"></div>
        <div class="photo-count" id="photoCount">Photos captured: 0 / 3</div>

        <!-- Main Grid Layout -->
        <div class="photobooth-grid">
            <!-- Camera & Controls -->
            <div class="left-column">
                <div class="camera-section">
                    <video id="video" autoplay playsinline></video>
                    <canvas id="canvas"></canvas>
                    <div class="countdown-overlay" id="countdown"></div>
                    <div class="flash-effect" id="flash"></div>
                </div>

                <div class="controls">
                    <button class="btn-primary" id="startBtn" onclick="startCamera()">Start Camera</button>
                    <button class="btn-primary" id="captureBtn" onclick="capturePhoto()" disabled>Take Photo (3 sec)</button>
                    <button class="btn-secondary" id="resetBtn" onclick="resetPhotos()" disabled>Reset All</button>
                    <button class="btn-success" id="downloadBtn" onclick="downloadStrip()" disabled>Download Photo Strip</button>
                </div>

                <div class="photos-grid" id="photosGrid"></div>
            </div>

            <!-- Filter & Layout Selection -->
            <div class="selection-row">
                <div class="filter-selector">
                    <h3>üé® Choose a Filter</h3>
                    
                    <div class="filter-options">
                        <div class="filter-option selected" onclick="selectFilter('none')">
                            <div class="filter-preview" style="filter: none;"></div>
                            <label>Normal</label>
                        </div>
                        <div class="filter-option" onclick="selectFilter('grayscale')">
                            <div class="filter-preview" style="filter: grayscale(100%);"></div>
                            <label>B&W</label>
                        </div>
                        <div class="filter-option" onclick="selectFilter('sepia')">
                            <div class="filter-preview" style="filter: sepia(100%);"></div>
                            <label>Sepia</label>
                        </div>
                        <div class="filter-option" onclick="selectFilter('vintage')">
                            <div class="filter-preview" style="filter: sepia(50%) contrast(120%) brightness(110%);"></div>
                            <label>Vintage</label>
                        </div>
                        <div class="filter-option" onclick="selectFilter('cool')">
                            <div class="filter-preview" style="filter: saturate(150%) hue-rotate(180deg);"></div>
                            <label>Cool</label>
                        </div>
                        <div class="filter-option" onclick="selectFilter('warm')">
                            <div class="filter-preview" style="filter: saturate(150%) hue-rotate(-20deg) brightness(110%);"></div>
                            <label>Warm</label>
                        </div>
                        <div class="filter-option" onclick="selectFilter('vivid')">
                            <div class="filter-preview" style="filter: saturate(200%) contrast(120%);"></div>
                            <label>Vivid</label>
                        </div>
                    </div>
                </div>

                <div class="layout-selector">
                    <h3>üìê Choose Your Layout</h3>
            
            <div class="layout-options">
                <div class="layout-option layout-a">
                    <input type="radio" name="layout" value="layoutA" id="layoutA" checked>
                    <div class="layout-preview">
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                    </div>
                    <label for="layoutA">Layout A</label>
                    <div class="layout-note">3 photos vertical</div>
                </div>

                <div class="layout-option layout-b">
                    <input type="radio" name="layout" value="layoutB" id="layoutB">
                    <div class="layout-preview">
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                    </div>
                    <label for="layoutB">Layout B</label>
                    <div class="layout-note">4 photos - 2x2 grid</div>
                </div>

                <div class="layout-option layout-c">
                    <input type="radio" name="layout" value="layoutC" id="layoutC">
                    <div class="layout-preview">
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                    </div>
                    <label for="layoutC">Layout C</label>
                    <div class="layout-note">2 photos large</div>
                </div>

                <div class="layout-option layout-d">
                    <input type="radio" name="layout" value="layoutD" id="layoutD">
                    <div class="layout-preview">
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                        <div class="layout-preview-box"></div>
                    </div>
                    <label for="layoutD">Layout D</label>
                    <div class="layout-note">6 photos mixed</div>
                </div>

                <div class="layout-option">
                    <input type="radio" name="layout" value="horizontal" id="layoutHorizontal">
                    <div class="layout-preview" style="flex-direction: row;">
                        <div class="layout-preview-box" style="width: 30%; height: 50px;"></div>
                        <div class="layout-preview-box" style="width: 30%; height: 50px;"></div>
                        <div class="layout-preview-box" style="width: 30%; height: 50px;"></div>
                    </div>
                    <label for="layoutHorizontal">Horizontal</label>
                    <div class="layout-note">3 photos side by side</div>
                </div>

                <div class="layout-option layout-e">
                    <input type="radio" name="layout" value="layoutE" id="layoutE">
                    <div class="layout-preview">
                        <div class="layout-preview-box heart-shape"></div>
                        <div class="layout-preview-box heart-shape"></div>
                        <div class="layout-preview-box heart-shape"></div>
                    </div>
                    <label for="layoutE">Heart Frames</label>
                    <div class="layout-note">3 photos with hearts</div>
                </div>

                <div class="layout-option layout-f">
                    <input type="radio" name="layout" value="layoutF" id="layoutF">
                    <div class="layout-preview">
                        <div class="layout-preview-box" style="width: 70%; height: 18px;"></div>
                        <div class="layout-preview-box" style="width: 70%; height: 18px;"></div>
                        <div class="layout-preview-box" style="width: 70%; height: 18px;"></div>
                        <div class="layout-preview-box" style="width: 70%; height: 18px;"></div>
                    </div>
                    <label for="layoutF">Classic Strip</label>
                    <div class="layout-note">4 photos classic</div>
                </div>
            </div>
        </div>
            </div>
        </div>

        <!-- Preview Section -->
        <div class="preview-section" id="previewSection">
            <h3>üì∏ Your Photostrip Preview</h3>
            <p class="subtitle">Here's how your photostrip will look!</p>
            <div class="preview-canvas-container">
                <canvas id="previewCanvas"></canvas>
            </div>
        </div>

        <!-- Customize Section -->
        <div class="customize-section" id="customizeSection">
            <h3>customize your photo</h3>
            
            <div class="customize-grid">
                <!-- Frame Color -->
                <div class="customize-group">
                    <h4>Frame Color</h4>
                    <div class="color-options">
                        <button class="color-btn selected" data-color="rainbow" style="background: linear-gradient(45deg, red, orange, yellow, green, blue, purple);"></button>
                        <button class="color-btn" data-color="#ffb6c1" style="background: #ffb6c1;"></button>
                        <button class="color-btn" data-color="#add8e6" style="background: #add8e6;"></button>
                        <button class="color-btn" data-color="#ffffe0" style="background: #ffffe0;"></button>
                        <button class="color-btn" data-color="#90ee90" style="background: #90ee90;"></button>
                        <button class="color-btn" data-color="#dda0dd" style="background: #dda0dd;"></button>
                        <button class="color-btn" data-color="#d2b48c" style="background: #d2b48c;"></button>
                        <button class="color-btn" data-color="#8b0000" style="background: #8b0000;"></button>
                        <button class="color-btn" data-color="#ffffff" style="background: #ffffff; border: 1px solid #ddd;"></button>
                        <button class="color-btn" data-color="#000000" style="background: #000000;"></button>
                        <button class="color-btn" data-color="#ff69b4" style="background: radial-gradient(circle, #ff69b4, #ff1493);"></button>
                        <button class="color-btn" data-color="gingham-pink" style="background: repeating-linear-gradient(45deg, #ffb6c1, #ffb6c1 5px, #ffffff 5px, #ffffff 10px);"></button>
                        <button class="color-btn" data-color="gingham-blue" style="background: repeating-linear-gradient(45deg, #add8e6, #add8e6 5px, #ffffff 5px, #ffffff 10px);"></button>
                        <button class="color-btn" data-color="checkered" style="background: repeating-conic-gradient(#000 0% 25%, #fff 0% 50%); background-size: 10px 10px;"></button>
                        <button class="color-btn" data-color="dots" style="background: radial-gradient(circle, #333 20%, transparent 20%), radial-gradient(circle, #333 20%, transparent 20%); background-size: 10px 10px; background-position: 0 0, 5px 5px;"></button>
                        <button class="color-btn" data-color="hearts-pink" style="background: #ffc0cb;"></button>
                        <button class="color-btn" data-color="polka" style="background: #000; background-image: radial-gradient(#fff 20%, transparent 20%); background-size: 8px 8px;"></button>
                        <button class="color-btn" data-color="gingham-red" style="background: repeating-linear-gradient(45deg, #ff6b6b, #ff6b6b 5px, #ffffff 5px, #ffffff 10px);"></button>
                        <button class="color-btn" data-color="red-gingham" style="background: repeating-linear-gradient(0deg, #dc143c, #dc143c 8px, #fff 8px, #fff 16px), repeating-linear-gradient(90deg, #dc143c, #dc143c 8px, #fff 8px, #fff 16px);"></button>
                        <button class="color-btn" data-color="stars" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></button>
                        <button class="color-btn" data-color="pastel-rainbow" style="background: linear-gradient(90deg, #ffadad, #ffd6a5, #fdffb6, #caffbf, #9bf6ff, #a0c4ff, #bdb2ff);"></button>
                        <button class="color-btn" data-color="sunset" style="background: linear-gradient(135deg, #ff6b6b, #ff8e53, #feca57);"></button>
                        <button class="color-btn" data-color="ocean" style="background: linear-gradient(135deg, #667eea, #4facfe);"></button>
                        <button class="color-btn" data-color="mint" style="background: linear-gradient(135deg, #a8edea, #fed6e3);"></button>
                        <button class="color-btn" data-color="peach" style="background: linear-gradient(135deg, #ffecd2, #fcb69f);"></button>
                        <button class="color-btn" data-color="lavender" style="background: linear-gradient(135deg, #e0c3fc, #8ec5fc);"></button>
                        <button class="color-btn" data-color="cherry" style="background: linear-gradient(135deg, #ff9a9e, #fad0c4);"></button>
                        <button class="color-btn" data-color="stripes-blue" style="background: repeating-linear-gradient(90deg, #add8e6, #add8e6 15px, #ffffff 15px, #ffffff 30px);"></button>
                        <button class="color-btn" data-color="stripes-pink" style="background: repeating-linear-gradient(90deg, #ffb6c1, #ffb6c1 15px, #ffffff 15px, #ffffff 30px);"></button>
                        <button class="color-btn" data-color="hearts-purple" style="background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);"></button>
                        <button class="color-btn" data-color="coral" style="background: #ff7f50;"></button>
                        <button class="color-btn" data-color="teal" style="background: #008080;"></button>
                        <button class="color-btn" data-color="rose-gold" style="background: linear-gradient(135deg, #d4af37, #f5e6d3);"></button>
                    </div>
                </div>

                <!-- Photo Shape -->
                <div class="customize-group">
                    <h4>Photo Shape</h4>
                    <div class="shape-options">
                        <button class="shape-btn" data-shape="square" title="Square">‚¨ú</button>
                        <button class="shape-btn selected" data-shape="rounded" title="Rounded">‚ñ¢</button>
                        <button class="shape-btn" data-shape="circle" title="Circle">‚≠ï</button>
                        <button class="shape-btn" data-shape="heart" title="Heart">‚ù§Ô∏è</button>
                    </div>
                </div>

                <!-- Stickers -->
                <div class="customize-group">
                    <h4>Stickers</h4>
                    <div class="stickers-grid">
                        <button class="sticker-btn" data-sticker="none">üö´</button>
                        <button class="sticker-btn" data-sticker="ghost">üëª</button>
                        <button class="sticker-btn" data-sticker="clover">üçÄ</button>
                        <button class="sticker-btn" data-sticker="kiss">üíã</button>
                        <button class="sticker-btn" data-sticker="heart">üíó</button>
                        <button class="sticker-btn" data-sticker="bow">üéÄ</button>
                        <button class="sticker-btn" data-sticker="star">‚≠ê</button>
                        <button class="sticker-btn" data-sticker="love">ü§ç</button>
                        <button class="sticker-btn" data-sticker="unicorn">ü¶Ñ</button>
                        <button class="sticker-btn" data-sticker="sparkle">‚ú®</button>
                        <button class="sticker-btn" data-sticker="music">üéµ</button>
                        <button class="sticker-btn" data-sticker="heart2">üíï</button>
                        <button class="sticker-btn" data-sticker="bear">üêª</button>
                        <button class="sticker-btn" data-sticker="koala">üê®</button>
                        <button class="sticker-btn" data-sticker="panda">üêº</button>
                        <button class="sticker-btn" data-sticker="frog">üê∏</button>
                        <button class="sticker-btn" data-sticker="flower">üå∏</button>
                        <button class="sticker-btn" data-sticker="cherry">üçí</button>
                        <button class="sticker-btn" data-sticker="cake">üéÇ</button>
                        <button class="sticker-btn" data-sticker="pizza">üçï</button>
                        <button class="sticker-btn" data-sticker="crown">üëë</button>
                        <button class="sticker-btn" data-sticker="fire">üî•</button>
                        <button class="sticker-btn" data-sticker="rainbow">üåà</button>
                        <button class="sticker-btn" data-sticker="moon">üåô</button>
                    </div>
                </div>

                <!-- Logo -->
                <div class="customize-group">
                    <h4>Logo:</h4>
                    <div class="logo-options">
                        <button class="logo-btn selected" data-logo="ENG">ENG</button>
                        <button class="logo-btn" data-logo="KOR">KOR</button>
                        <button class="logo-btn" data-logo="CN">CN</button>
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="addDate" checked>
                            <span>Add Date</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="addTime">
                            <span>Add Time</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="customize-actions">
                <button class="btn-retake" onclick="retakePhotos()">Retake</button>
                <button class="btn-download" onclick="downloadCustomized()">Download</button>
            </div>
        </div>
    </div>

    <script>
        let stream = null;
        let photos = [];
        let maxPhotos = 3; // Will be updated based on layout
        let countdownInterval = null;
        let currentFilter = 'none'; // Current selected filter
        
        // Customization options
        let customOptions = {
            frameColor: 'rainbow',
            photoShape: 'rounded',
            sticker: 'none',
            logo: 'ENG',
            addDate: true,
            addTime: false
        };

        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const captureBtn = document.getElementById('captureBtn');
        const resetBtn = document.getElementById('resetBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const photosGrid = document.getElementById('photosGrid');
        const photoCount = document.getElementById('photoCount');
        const messageContainer = document.getElementById('messageContainer');
        const countdownOverlay = document.getElementById('countdown');
        const flashEffect = document.getElementById('flash');

        // Layout photo requirements
        const layoutRequirements = {
            'layoutA': 3,
            'layoutB': 4,
            'layoutC': 2,
            'layoutD': 6,
            'horizontal': 3,
            'layoutE': 3,
            'layoutF': 4
        };

        // Filter selection and application
        function selectFilter(filterName) {
            currentFilter = filterName;
            
            // Update UI
            document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('selected'));
            event.target.closest('.filter-option').classList.add('selected');
            
            // Apply filter to video preview
            applyFilterToVideo();
        }

        function applyFilterToVideo() {
            const filterStyles = {
                'none': 'none',
                'grayscale': 'grayscale(100%)',
                'sepia': 'sepia(100%)',
                'vintage': 'sepia(50%) contrast(120%) brightness(110%)',
                'cool': 'saturate(150%) hue-rotate(180deg)',
                'warm': 'saturate(150%) hue-rotate(-20deg) brightness(110%)',
                'vivid': 'saturate(200%) contrast(120%)'
            };
            
            video.style.filter = filterStyles[currentFilter] || 'none';
        }

        function applyFilterToCanvas(ctx, width, height) {
            if (currentFilter === 'none') return;
            
            const imageData = ctx.getImageData(0, 0, width, height);
            const data = imageData.data;
            
            switch (currentFilter) {
                case 'grayscale':
                    for (let i = 0; i < data.length; i += 4) {
                        const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
                        data[i] = data[i + 1] = data[i + 2] = gray;
                    }
                    break;
                case 'sepia':
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i], g = data[i + 1], b = data[i + 2];
                        data[i] = Math.min(255, r * 0.393 + g * 0.769 + b * 0.189);
                        data[i + 1] = Math.min(255, r * 0.349 + g * 0.686 + b * 0.168);
                        data[i + 2] = Math.min(255, r * 0.272 + g * 0.534 + b * 0.131);
                    }
                    break;
                case 'vintage':
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i], g = data[i + 1], b = data[i + 2];
                        data[i] = Math.min(255, (r * 0.393 + g * 0.769 + b * 0.189) * 1.2);
                        data[i + 1] = Math.min(255, (r * 0.349 + g * 0.686 + b * 0.168) * 1.2);
                        data[i + 2] = Math.min(255, (r * 0.272 + g * 0.534 + b * 0.131) * 1.1);
                    }
                    break;
                case 'cool':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 0.7);
                        data[i + 2] = Math.min(255, data[i + 2] * 1.5);
                    }
                    break;
                case 'warm':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.5);
                        data[i + 2] = Math.min(255, data[i + 2] * 0.7);
                    }
                    break;
                case 'vivid':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, data[i] * 1.3);
                        data[i + 1] = Math.min(255, data[i + 1] * 1.3);
                        data[i + 2] = Math.min(255, data[i + 2] * 1.3);
                    }
                    break;
            }
            
            ctx.putImageData(imageData, 0, 0);
        }

        // Get required photos for current layout
        function getRequiredPhotos() {
            const layout = document.querySelector('input[name="layout"]:checked')?.value || 'layoutA';
            return layoutRequirements[layout] || 3;
        }

        // Update photo count display
        function updatePhotoCountDisplay() {
            maxPhotos = getRequiredPhotos();
            photoCount.textContent = `Photos captured: ${photos.length} / ${maxPhotos}`;
        }

        // Page Navigation Functions
        function showPhotobooth() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('photoboothApp').classList.add('active');
            document.querySelector('nav').style.display = 'none';
            document.querySelector('.top-banner').style.display = 'none';
        }

        function showLanding() {
            document.getElementById('landingPage').style.display = 'flex';
            document.getElementById('photoboothApp').classList.remove('active');
            document.querySelector('nav').style.display = 'flex';
            document.querySelector('.top-banner').style.display = 'block';
            
            // Stop camera if active
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                video.srcObject = null;
                startBtn.disabled = false;
                captureBtn.disabled = true;
            }
        }

        function showMessage(message, type = 'info') {
            messageContainer.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                messageContainer.innerHTML = '';
            }, 5000);
        }

        // Layout Selection Handler
        document.addEventListener('DOMContentLoaded', function() {
            const layoutOptions = document.querySelectorAll('.layout-option');
            
            layoutOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    layoutOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Check the radio button inside
                    const radio = this.querySelector('input[type="radio"]');
                    if (radio) {
                        radio.checked = true;
                        updatePhotoCountDisplay();
                        
                        // Update capture button state
                        const requiredPhotos = getRequiredPhotos();
                        if (photos.length >= requiredPhotos) {
                            captureBtn.disabled = true;
                            downloadBtn.disabled = false;
                            showMessage(`You have enough photos for this layout! (${photos.length}/${requiredPhotos})`, 'success');
                        } else if (photos.length > 0) {
                            captureBtn.disabled = false;
                            downloadBtn.disabled = true;
                            showMessage(`Layout changed! You need ${requiredPhotos - photos.length} more photo(s).`, 'info');
                        }
                    }
                });
            });
            
            // Initialize with default layout
            updatePhotoCountDisplay();
        });

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }, 
                    audio: false 
                });
                
                video.srcObject = stream;
                startBtn.disabled = true;
                captureBtn.disabled = false;
                showMessage('Camera started! Click "Take Photo" to capture.', 'success');
            } catch (error) {
                console.error('Error accessing camera:', error);
                showMessage('Error: Could not access camera. Please allow camera permissions.', 'error');
            }
        }

        function capturePhoto() {
            const requiredPhotos = getRequiredPhotos();
            if (photos.length >= requiredPhotos) {
                showMessage(`You already have ${requiredPhotos} photos! Reset to take more.`, 'info');
                return;
            }

            captureBtn.disabled = true;
            startCountdown();
        }

        function startCountdown() {
            let count = 3;
            countdownOverlay.textContent = count;
            countdownOverlay.classList.add('active');

            countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownOverlay.textContent = count;
                } else {
                    clearInterval(countdownInterval);
                    countdownOverlay.classList.remove('active');
                    takeSnapshot();
                }
            }, 1000);
        }

        function takeSnapshot() {
            // Flash effect
            flashEffect.classList.add('active');
            setTimeout(() => {
                flashEffect.classList.remove('active');
            }, 300);

            // Set canvas size to match video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            // Flip the canvas horizontally to mirror the video
            ctx.save();
            ctx.scale(-1, 1);
            ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
            ctx.restore();

            // Apply filter to the captured image
            applyFilterToCanvas(ctx, canvas.width, canvas.height);

            // Get image data
            const imageData = canvas.toDataURL('image/png');
            photos.push(imageData);

            // Update UI
            updatePhotosDisplay();
            updatePhotoCountDisplay();

            const requiredPhotos = getRequiredPhotos();
            if (photos.length >= requiredPhotos) {
                captureBtn.disabled = true;
                downloadBtn.disabled = false;
                showMessage(`All ${requiredPhotos} photos captured! You can download your photo strip now.`, 'success');
                // Show preview
                generatePreview();
            } else {
                captureBtn.disabled = false;
                showMessage(`Photo ${photos.length} captured! ${requiredPhotos - photos.length} more to go.`, 'success');
            }

            resetBtn.disabled = false;
        }

        function updatePhotosDisplay() {
            photosGrid.innerHTML = '';
            photos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                photoItem.innerHTML = `
                    <img src="${photo}" alt="Photo ${index + 1}">
                    <div class="photo-number">${index + 1}</div>
                    <button class="delete-btn" onclick="deletePhoto(${index})">√ó</button>
                `;
                photosGrid.appendChild(photoItem);
            });
        }

        function deletePhoto(index) {
            photos.splice(index, 1);
            updatePhotosDisplay();
            updatePhotoCountDisplay();

            const requiredPhotos = getRequiredPhotos();
            if (photos.length < requiredPhotos) {
                captureBtn.disabled = false;
                downloadBtn.disabled = photos.length === 0;
                // Hide preview when photos are removed
                document.getElementById('previewSection').classList.remove('active');
            }

            if (photos.length === 0) {
                resetBtn.disabled = true;
            }

            showMessage(`Photo ${index + 1} deleted.`, 'info');
        }

        function resetPhotos() {
            if (confirm('Are you sure you want to delete all photos?')) {
                photos = [];
                updatePhotosDisplay();
                updatePhotoCountDisplay();
                captureBtn.disabled = false;
                resetBtn.disabled = true;
                downloadBtn.disabled = true;
                document.getElementById('previewSection').classList.remove('active');
                showMessage('All photos reset. Start capturing new ones!', 'info');
            }
        }

        async function generatePreview() {
            const previewSection = document.getElementById('previewSection');
            const customizeSection = document.getElementById('customizeSection');
            const previewCanvas = document.getElementById('previewCanvas');
            const layout = document.querySelector('input[name="layout"]:checked').value;

            // Draw the photo strip on the preview canvas
            await drawPhotoStripOnCanvas(previewCanvas, layout);
            
            // Show the preview and customize sections
            previewSection.classList.add('active');
            customizeSection.classList.add('active');
            
            // Scroll to preview
            setTimeout(() => {
                previewSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        async function drawPhotoStripOnCanvas(targetCanvas, layout) {
            const stripCtx = targetCanvas.getContext('2d');
            
            // Load all images first
            const loadedImages = await Promise.all(photos.map(photoSrc => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.src = photoSrc;
                });
            }));

            // Set dimensions based on layout
            const photoWidth = 500;
            const photoHeight = 375;
            const padding = 30;
            const photoPadding = 15;
            const headerSize = 100;
            const footerSize = 60;
            const borderWidth = 40;

            // Calculate canvas size based on layout
            if (layout === 'layoutA') {
                // 3 photos vertical
                targetCanvas.width = photoWidth + (padding * 2) + (borderWidth * 2);
                targetCanvas.height = (photoHeight * 3) + (photoPadding * 2) + (padding * 2) + headerSize + footerSize + (borderWidth * 2);
            } else if (layout === 'layoutB') {
                // 2x2 grid (4 photos)
                targetCanvas.width = (photoWidth * 2) + photoPadding + (padding * 2) + (borderWidth * 2);
                targetCanvas.height = (photoHeight * 2) + photoPadding + (padding * 2) + headerSize + footerSize + (borderWidth * 2);
            } else if (layout === 'layoutC') {
                // 2 photos large vertical
                targetCanvas.width = photoWidth + (padding * 2) + (borderWidth * 2);
                targetCanvas.height = (photoHeight * 2) + photoPadding + (padding * 2) + headerSize + footerSize + (borderWidth * 2);
            } else if (layout === 'layoutD') {
                // Mixed layout (collage style)
                targetCanvas.width = (photoWidth * 2) + photoPadding + (padding * 2) + (borderWidth * 2);
                targetCanvas.height = (photoHeight * 2) + photoPadding + (padding * 2) + headerSize + footerSize + (borderWidth * 2);
            } else if (layout === 'layoutE') {
                // Heart-framed vertical strip (3 photos)
                targetCanvas.width = photoWidth + (padding * 2) + (borderWidth * 2) + 60; // Extra space for heart frames
                targetCanvas.height = (photoHeight * 3) + (photoPadding * 3) + (padding * 2) + headerSize + footerSize + (borderWidth * 2) + 90; // Extra height for decorations
            } else if (layout === 'layoutF') {
                // Classic photostrip (4 photos)
                targetCanvas.width = photoWidth + (padding * 2) + (borderWidth * 2) + 30;
                targetCanvas.height = (photoHeight * 4) + (photoPadding * 3) + (padding * 2) + 100 + (borderWidth * 2);
            } else {
                // Horizontal layout - wider to fit 3 photos side by side
                targetCanvas.width = (photoWidth * 3) + (photoPadding * 2) + (padding * 2) + (borderWidth * 2);
                targetCanvas.height = photoHeight + (padding * 2) + headerSize + footerSize + (borderWidth * 2);
            }

            // Apply custom background color/pattern
            if (customOptions.frameColor === 'rainbow') {
                const gradient = (layout === 'horizontal')
                    ? stripCtx.createLinearGradient(0, 0, targetCanvas.width, 0)
                    : stripCtx.createLinearGradient(0, 0, 0, targetCanvas.height);
                gradient.addColorStop(0, '#e0c3fc');
                gradient.addColorStop(0.33, '#c3a6f5');
                gradient.addColorStop(0.66, '#a78bfa');
                gradient.addColorStop(1, '#8b5cf6');
                stripCtx.fillStyle = gradient;
                stripCtx.fillRect(0, 0, targetCanvas.width, targetCanvas.height);
            } else if (customOptions.frameColor.startsWith('gingham')) {
                // Gingham pattern
                stripCtx.fillStyle = '#ffffff';
                stripCtx.fillRect(0, 0, targetCanvas.width, targetCanvas.height);
                const patternColor = customOptions.frameColor.includes('pink') ? '#ffb6c1' : 
                                    customOptions.frameColor.includes('blue') ? '#add8e6' : '#ff6b6b';
                stripCtx.fillStyle = patternColor;
                for (let y = 0; y < targetCanvas.height; y += 20) {
                    for (let x = 0; x < targetCanvas.width; x += 20) {
                        if ((Math.floor(x / 20) + Math.floor(y / 20)) % 2 === 0) {
                            stripCtx.fillRect(x, y, 20, 20);
                        }
                    }
                }
            } else if (customOptions.frameColor === 'checkered') {
                stripCtx.fillStyle = '#000000';
                stripCtx.fillRect(0, 0, targetCanvas.width, targetCanvas.height);
                stripCtx.fillStyle = '#ffffff';
                for (let y = 0; y < targetCanvas.height; y += 20) {
                    for (let x = 0; x < targetCanvas.width; x += 20) {
                        if ((Math.floor(x / 20) + Math.floor(y / 20)) % 2 === 0) {
                            stripCtx.fillRect(x, y, 20, 20);
                        }
                    }
                }
            } else if (customOptions.frameColor === 'dots' || customOptions.frameColor === 'polka') {
                stripCtx.fillStyle = customOptions.frameColor === 'polka' ? '#000000' : '#ffffff';
                stripCtx.fillRect(0, 0, targetCanvas.width, targetCanvas.height);
                stripCtx.fillStyle = customOptions.frameColor === 'polka' ? '#ffffff' : '#333333';
                for (let y = 10; y < targetCanvas.height; y += 20) {
                    for (let x = 10; x < targetCanvas.width; x += 20) {
                        stripCtx.beginPath();
                        stripCtx.arc(x, y, 4, 0, Math.PI * 2);
                        stripCtx.fill();
                    }
                }
            } else if (customOptions.frameColor === 'red-gingham') {
                stripCtx.fillStyle = '#ffffff';
                stripCtx.fillRect(0, 0, targetCanvas.width, targetCanvas.height);
                stripCtx.fillStyle = '#dc143c';
                for (let y = 0; y < targetCanvas.height; y += 16) {
                    stripCtx.fillRect(0, y, targetCanvas.width, 8);
                }
                for (let x = 0; x < targetCanvas.width; x += 16) {
                    stripCtx.fillRect(x, 0, 8, targetCanvas.height);
                }
            } else if (customOptions.frameColor === 'hearts-pink' || customOptions.frameColor === 'hearts-purple') {
                // Heart pattern background
                const bgColor = customOptions.frameColor === 'hearts-pink' ? '#ffc0cb' : '#e0c3fc';
                const heartColor = customOptions.frameColor === 'hearts-pink' ? '#ff69b4' : '#a18cd1';
                stripCtx.fillStyle = bgColor;
                stripCtx.fillRect(0, 0, targetCanvas.width, targetCanvas.height);
                
                // Draw hearts pattern
                stripCtx.fillStyle = heartColor;
                stripCtx.font = '30px Arial';
                for (let y = 30; y < targetCanvas.height; y += 60) {
                    for (let x = 30; x < targetCanvas.width; x += 60) {
                        const offset = (Math.floor(y / 60) % 2) * 30;
                        stripCtx.fillText('üíó', x + offset, y);
                    }
                }
            } else if (customOptions.frameColor === 'stars') {
                const gradient = stripCtx.createLinearGradient(0, 0, 0, targetCanvas.height);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                stripCtx.fillStyle = gradient;
                stripCtx.fillRect(0, 0, targetCanvas.width, targetCanvas.height);
                
                // Add stars
                stripCtx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                stripCtx.font = '20px Arial';
                for (let y = 30; y < targetCanvas.height; y += 80) {
                    for (let x = 30; x < targetCanvas.width; x += 80) {
                        const offset = (Math.floor(y / 80) % 2) * 40;
                        stripCtx.fillText('‚≠ê', x + offset, y);
                    }
                }
            } else if (customOptions.frameColor.startsWith('stripes-')) {
                stripCtx.fillStyle = '#ffffff';
                stripCtx.fillRect(0, 0, targetCanvas.width, targetCanvas.height);
                const stripeColor = customOptions.frameColor.includes('pink') ? '#ffb6c1' : '#add8e6';
                stripCtx.fillStyle = stripeColor;
                for (let x = 0; x < targetCanvas.width; x += 30) {
                    stripCtx.fillRect(x, 0, 15, targetCanvas.height);
                }
            } else {
                // Solid color or gradient
                stripCtx.fillStyle = customOptions.frameColor;
                stripCtx.fillRect(0, 0, targetCanvas.width, targetCanvas.height);
            }

            // Outer border
            stripCtx.strokeStyle = '#ffffff';
            stripCtx.lineWidth = borderWidth;
            stripCtx.strokeRect(borderWidth / 2, borderWidth / 2, targetCanvas.width - borderWidth, targetCanvas.height - borderWidth);

            // Decorative corner elements
            const cornerSize = 30;
            stripCtx.fillStyle = '#ffffff';
            // Top left
            stripCtx.fillRect(borderWidth, borderWidth, cornerSize, 5);
            stripCtx.fillRect(borderWidth, borderWidth, 5, cornerSize);
            // Top right
            stripCtx.fillRect(targetCanvas.width - borderWidth - cornerSize, borderWidth, cornerSize, 5);
            stripCtx.fillRect(targetCanvas.width - borderWidth - 5, borderWidth, 5, cornerSize);
            // Bottom left
            stripCtx.fillRect(borderWidth, targetCanvas.height - borderWidth - 5, cornerSize, 5);
            stripCtx.fillRect(borderWidth, targetCanvas.height - borderWidth - cornerSize, 5, cornerSize);
            // Bottom right
            stripCtx.fillRect(targetCanvas.width - borderWidth - cornerSize, targetCanvas.height - borderWidth - 5, cornerSize, 5);
            stripCtx.fillRect(targetCanvas.width - borderWidth - 5, targetCanvas.height - borderWidth - cornerSize, 5, cornerSize);

            const date = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            // Draw header for all layouts
            function drawHeader(x, y, centered = true) {
                stripCtx.font = 'bold 40px Arial';
                stripCtx.textAlign = centered ? 'center' : 'left';
                
                // Use custom logo or default
                const logoText = customOptions.logo === 'ENG' ? 'üíú Memories üíú' :
                                customOptions.logo === 'KOR' ? 'üíú Ï∂îÏñµ üíú' :
                                customOptions.logo === 'CN' ? 'üíú ÂõûÂøÜ üíú' :
                                'üíú Memories üíú';
                
                // Draw text with stronger outline for better visibility
                // Black outline
                stripCtx.strokeStyle = '#000000';
                stripCtx.lineWidth = 6;
                stripCtx.strokeText(logoText, x, y);
                
                // White fill
                stripCtx.fillStyle = '#ffffff';
                stripCtx.shadowColor = 'rgba(0, 0, 0, 0.8)';
                stripCtx.shadowBlur = 15;
                stripCtx.shadowOffsetX = 3;
                stripCtx.shadowOffsetY = 3;
                stripCtx.fillText(logoText, x, y);

                // Reset shadow and draw date/time
                stripCtx.shadowBlur = 0;
                stripCtx.shadowOffsetX = 0;
                stripCtx.shadowOffsetY = 0;
                stripCtx.font = '16px Arial';
                
                // Show date and/or time based on options
                let dateTimeText = '';
                if (customOptions.addDate) {
                    dateTimeText = date;
                }
                if (customOptions.addTime) {
                    const time = new Date().toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    dateTimeText += (dateTimeText ? ' ' : '') + time;
                }
                if (dateTimeText) {
                    // Outline for date/time
                    stripCtx.strokeStyle = '#000000';
                    stripCtx.lineWidth = 3;
                    stripCtx.strokeText(dateTimeText, x, y + 25);
                    
                    stripCtx.fillStyle = '#ffffff';
                    stripCtx.shadowColor = 'rgba(0, 0, 0, 0.6)';
                    stripCtx.shadowBlur = 10;
                    stripCtx.fillText(dateTimeText, x, y + 25);
                    
                    stripCtx.shadowBlur = 0;
                }
            }

            // Draw footer for all layouts
            function drawFooter(x, y, centered = true) {
                stripCtx.font = '14px Arial';
                stripCtx.textAlign = centered ? 'center' : 'left';
                
                const footerText = 'Made with üíú in Photo Booth';
                
                // Black outline
                stripCtx.strokeStyle = '#000000';
                stripCtx.lineWidth = 3;
                stripCtx.strokeText(footerText, x, y);
                
                // White fill with shadow
                stripCtx.fillStyle = '#ffffff';
                stripCtx.shadowColor = 'rgba(0, 0, 0, 0.6)';
                stripCtx.shadowBlur = 8;
                stripCtx.fillText(footerText, x, y);
                
                stripCtx.shadowBlur = 0;
            }

            // Helper function to apply photo shape clipping
            function applyPhotoShape(x, y, width, height) {
                if (customOptions.photoShape === 'circle') {
                    stripCtx.beginPath();
                    stripCtx.arc(x + width / 2, y + height / 2, Math.min(width, height) / 2, 0, Math.PI * 2);
                    stripCtx.clip();
                } else if (customOptions.photoShape === 'rounded') {
                    const radius = 20;
                    stripCtx.beginPath();
                    stripCtx.moveTo(x + radius, y);
                    stripCtx.lineTo(x + width - radius, y);
                    stripCtx.quadraticCurveTo(x + width, y, x + width, y + radius);
                    stripCtx.lineTo(x + width, y + height - radius);
                    stripCtx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                    stripCtx.lineTo(x + radius, y + height);
                    stripCtx.quadraticCurveTo(x, y + height, x, y + height - radius);
                    stripCtx.lineTo(x, y + radius);
                    stripCtx.quadraticCurveTo(x, y, x + radius, y);
                    stripCtx.clip();
                } else if (customOptions.photoShape === 'heart') {
                    // Perfect heart shape
                    const centerX = x + width / 2;
                    const topY = y + height * 0.25;
                    const scale = Math.min(width, height) * 0.45;
                    
                    stripCtx.beginPath();
                    
                    // Start at the bottom point of the heart
                    stripCtx.moveTo(centerX, topY + scale * 1.6);
                    
                    // Left side of heart
                    stripCtx.bezierCurveTo(
                        centerX - scale * 1.1, topY + scale,
                        centerX - scale * 1.1, topY + scale * 0.4,
                        centerX - scale * 0.55, topY + scale * 0.4
                    );
                    
                    // Left top curve (lobe)
                    stripCtx.bezierCurveTo(
                        centerX - scale * 0.7, topY,
                        centerX - scale * 0.3, topY,
                        centerX, topY + scale * 0.3
                    );
                    
                    // Right top curve (lobe)
                    stripCtx.bezierCurveTo(
                        centerX + scale * 0.3, topY,
                        centerX + scale * 0.7, topY,
                        centerX + scale * 0.55, topY + scale * 0.4
                    );
                    
                    // Right side of heart
                    stripCtx.bezierCurveTo(
                        centerX + scale * 1.1, topY + scale * 0.4,
                        centerX + scale * 1.1, topY + scale,
                        centerX, topY + scale * 1.6
                    );
                    
                    stripCtx.closePath();
                    stripCtx.clip();
                }
            }

            // Helper function to draw sticker on photo
            function drawSticker(x, y, width, height, photoIndex = 0) {
                if (customOptions.sticker && customOptions.sticker !== 'none') {
                    const stickerMap = {
                        'ghost': 'üëª', 'clover': 'üçÄ', 'kiss': 'üíã', 'heart': 'üíó',
                        'bow': 'üéÄ', 'star': '‚≠ê', 'love': 'ü§ç', 'unicorn': 'ü¶Ñ',
                        'sparkle': '‚ú®', 'music': 'üéµ', 'heart2': 'üíï', 'bear': 'üêª',
                        'koala': 'üê®', 'panda': 'üêº', 'frog': 'üê∏', 'flower': 'üå∏',
                        'cherry': 'üçí', 'cake': 'üéÇ', 'pizza': 'üçï', 'crown': 'üëë',
                        'fire': 'üî•', 'rainbow': 'üåà', 'moon': 'üåô'
                    };
                    
                    const sticker = stickerMap[customOptions.sticker];
                    if (!sticker) return;
                    
                    // Create pseudo-random positions based on photo index for consistency
                    const positions = [
                        { xOffset: -30, yOffset: -20, rotation: -15 },  // Top left outside
                        { xOffset: width + 10, yOffset: -20, rotation: 15 },  // Top right outside
                        { xOffset: -30, yOffset: height - 20, rotation: 15 },  // Bottom left outside
                        { xOffset: width + 5, yOffset: height - 20, rotation: -15 },  // Bottom right outside
                        { xOffset: width - 50, yOffset: 20, rotation: 10 },  // Top right inside
                        { xOffset: 20, yOffset: 20, rotation: -10 }  // Top left inside
                    ];
                    
                    const pos = positions[photoIndex % positions.length];
                    
                    stripCtx.save();
                    stripCtx.translate(x + pos.xOffset, y + pos.yOffset);
                    stripCtx.rotate((pos.rotation * Math.PI) / 180);
                    stripCtx.font = '55px Arial';
                    stripCtx.textAlign = 'center';
                    stripCtx.textBaseline = 'middle';
                    
                    // Add white outline for sticker to stand out
                    stripCtx.strokeStyle = '#ffffff';
                    stripCtx.lineWidth = 4;
                    stripCtx.strokeText(sticker, 0, 0);
                    stripCtx.fillText(sticker, 0, 0);
                    
                    stripCtx.restore();
                }
            }

            // Draw photo with polaroid frame
            function drawPhotoWithFrame(img, x, y, width, height, number) {
                // White polaroid frame
                stripCtx.fillStyle = '#ffffff';
                stripCtx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                stripCtx.shadowBlur = 15;
                stripCtx.shadowOffsetX = 0;
                stripCtx.shadowOffsetY = 5;
                stripCtx.fillRect(x - 12, y - 12, width + 24, height + 40);

                // Reset shadow
                stripCtx.shadowBlur = 0;
                stripCtx.shadowOffsetX = 0;
                stripCtx.shadowOffsetY = 0;

                // Draw photo with shape
                stripCtx.save();
                applyPhotoShape(x, y, width, height);
                stripCtx.drawImage(img, x, y, width, height);
                stripCtx.restore();

                // Add sticker
                drawSticker(x, y, width, height, number - 1);

                // Photo number
                stripCtx.fillStyle = '#666';
                stripCtx.font = 'italic 16px Arial';
                stripCtx.textAlign = 'center';
                stripCtx.fillText(`Photo ${number}`, x + width / 2, y + height + 25);

                // Heart decoration
                stripCtx.fillStyle = '#a18cd1';
                stripCtx.font = '14px Arial';
                stripCtx.fillText('üíú', x + width - 15, y + height + 25);
            }

            if (layout === 'layoutA') {
                // LAYOUT A: 3 photos vertical
                drawHeader(targetCanvas.width / 2, borderWidth + 50);
                
                const startY = borderWidth + headerSize;
                loadedImages.slice(0, 3).forEach((img, index) => {
                    const y = startY + (index * (photoHeight + photoPadding));
                    const x = borderWidth + padding;
                    drawPhotoWithFrame(img, x, y, photoWidth, photoHeight, index + 1);
                });

                const footerY = borderWidth + headerSize + (photoHeight * 3) + (photoPadding * 2) + padding + 70;
                drawFooter(targetCanvas.width / 2, footerY);

            } else if (layout === 'layoutB') {
                // LAYOUT B: 2x2 grid (4 photos)
                drawHeader(targetCanvas.width / 2, borderWidth + 50);
                
                const startY = borderWidth + headerSize;
                const startX = borderWidth + padding;
                const smallWidth = (photoWidth * 2 + photoPadding) / 2 - photoPadding / 2;
                const smallHeight = (photoHeight * 2 + photoPadding) / 2 - photoPadding / 2;

                // Draw all 4 photos in 2x2 grid
                for (let row = 0; row < 2; row++) {
                    for (let col = 0; col < 2; col++) {
                        const photoIndex = row * 2 + col;
                        if (photoIndex < loadedImages.length) {
                            const img = loadedImages[photoIndex];
                            const x = startX + (col * (smallWidth + photoPadding));
                            const y = startY + (row * (smallHeight + photoPadding));
                            drawPhotoWithFrame(img, x, y, smallWidth, smallHeight, photoIndex + 1);
                        }
                    }
                }

                const footerY = startY + (smallHeight * 2) + photoPadding + 80;
                drawFooter(targetCanvas.width / 2, footerY);

            } else if (layout === 'layoutC') {
                // LAYOUT C: 2 large photos vertical
                drawHeader(targetCanvas.width / 2, borderWidth + 50);
                
                const startY = borderWidth + headerSize;
                loadedImages.slice(0, 2).forEach((img, index) => {
                    const y = startY + (index * (photoHeight + photoPadding));
                    const x = borderWidth + padding;
                    drawPhotoWithFrame(img, x, y, photoWidth, photoHeight, index + 1);
                });

                const footerY = borderWidth + headerSize + (photoHeight * 2) + photoPadding + 70;
                drawFooter(targetCanvas.width / 2, footerY);

            } else if (layout === 'layoutD') {
                // LAYOUT D: Mixed/collage (6 photos - 2 large top, 4 small bottom)
                drawHeader(targetCanvas.width / 2, borderWidth + 50);
                
                const startY = borderWidth + headerSize;
                const startX = borderWidth + padding;
                const largeWidth = (photoWidth * 2 + photoPadding) / 2 - photoPadding / 2;
                const largeHeight = photoHeight;
                const smallWidth = largeWidth / 2 - photoPadding / 2;
                const smallHeight = photoHeight / 2 - photoPadding / 2;

                // Top: 2 large photos side by side
                for (let i = 0; i < 2 && i < loadedImages.length; i++) {
                    const img = loadedImages[i];
                    const x = startX + (i * (largeWidth + photoPadding));
                    drawPhotoWithFrame(img, x, startY, largeWidth, largeHeight, i + 1);
                }

                // Bottom: Grid of 4 smaller photos
                const bottomY = startY + largeHeight + photoPadding;
                for (let row = 0; row < 2; row++) {
                    for (let col = 0; col < 2; col++) {
                        const photoIndex = 2 + (row * 2) + col;
                        if (photoIndex < loadedImages.length) {
                            const img = loadedImages[photoIndex];
                            const x = startX + (col * (smallWidth + photoPadding));
                            const y = bottomY + (row * (smallHeight + photoPadding));
                            
                            stripCtx.fillStyle = '#ffffff';
                            stripCtx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                            stripCtx.shadowBlur = 10;
                            stripCtx.fillRect(x - 8, y - 8, smallWidth + 16, smallHeight + 16);
                            stripCtx.shadowBlur = 0;
                            
                            // Apply shape and draw photo
                            stripCtx.save();
                            applyPhotoShape(x, y, smallWidth, smallHeight);
                            stripCtx.drawImage(img, x, y, smallWidth, smallHeight);
                            stripCtx.restore();
                            
                            // Add sticker
                            drawSticker(x, y, smallWidth, smallHeight, photoIndex);
                            
                            // Add photo number
                            stripCtx.fillStyle = '#666';
                            stripCtx.font = 'italic 12px Arial';
                            stripCtx.textAlign = 'center';
                            stripCtx.fillText(`${photoIndex + 1}`, x + smallWidth / 2, y + smallHeight - 10);
                        }
                    }
                }

                const footerY = bottomY + (smallHeight * 2) + photoPadding + 60;
                drawFooter(targetCanvas.width / 2, footerY);

            } else if (layout === 'horizontal') {
                // HORIZONTAL LAYOUT - Clean horizontal strip with header on top
                drawHeader(targetCanvas.width / 2, borderWidth + 50);
                
                const startY = borderWidth + headerSize;
                const startX = borderWidth + padding;
                
                // Draw photos horizontally in a row
                loadedImages.forEach((img, index) => {
                    const x = startX + (index * (photoWidth + photoPadding));
                    const y = startY;

                    // White polaroid frame
                    stripCtx.fillStyle = '#ffffff';
                    stripCtx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    stripCtx.shadowBlur = 15;
                    stripCtx.shadowOffsetX = 0;
                    stripCtx.shadowOffsetY = 5;
                    stripCtx.fillRect(x - 12, y - 12, photoWidth + 24, photoHeight + 40);

                    // Reset shadow for photo
                    stripCtx.shadowBlur = 0;
                    stripCtx.shadowOffsetX = 0;
                    stripCtx.shadowOffsetY = 0;

                    // Draw photo with shape
                    stripCtx.save();
                    applyPhotoShape(x, y, photoWidth, photoHeight);
                    stripCtx.drawImage(img, x, y, photoWidth, photoHeight);
                    stripCtx.restore();
                    
                    // Add sticker
                    drawSticker(x, y, photoWidth, photoHeight, index);

                    // Photo number in polaroid bottom space
                    stripCtx.fillStyle = '#666';
                    stripCtx.font = 'italic 16px Arial';
                    stripCtx.textAlign = 'center';
                    stripCtx.fillText(`Photo ${index + 1}`, x + photoWidth / 2, y + photoHeight + 25);

                    // Add small heart decoration
                    stripCtx.fillStyle = '#a18cd1';
                    stripCtx.font = '14px Arial';
                    stripCtx.fillText('üíú', x + photoWidth - 15, y + photoHeight + 25);
                });

                // Footer section at the bottom
                const footerY = startY + photoHeight + 90;
                drawFooter(targetCanvas.width / 2, footerY);

            } else if (layout === 'layoutE') {
                // LAYOUT E: Heart-framed vertical strip
                drawHeader(targetCanvas.width / 2, borderWidth + 50);
                
                const startY = borderWidth + headerSize;
                const heartSpacing = 10;
                
                loadedImages.slice(0, 3).forEach((img, index) => {
                    const y = startY + (index * (photoHeight + photoPadding + 30));
                    const x = borderWidth + padding;
                    
                    // Draw heart frame (simplified as rounded border)
                    stripCtx.save();
                    
                    // Pink heart outline
                    stripCtx.strokeStyle = '#ff69b4';
                    stripCtx.lineWidth = 8;
                    stripCtx.shadowColor = 'rgba(255, 105, 180, 0.4)';
                    stripCtx.shadowBlur = 15;
                    
                    // Draw heart shape background
                    const heartWidth = photoWidth + 40;
                    const heartHeight = photoHeight + 40;
                    const heartX = x - 20;
                    const heartY = y - 20;
                    
                    stripCtx.beginPath();
                    stripCtx.moveTo(heartX + heartWidth / 2, heartY + heartHeight / 4);
                    stripCtx.quadraticCurveTo(heartX + heartWidth / 2, heartY, heartX + heartWidth / 4, heartY);
                    stripCtx.quadraticCurveTo(heartX, heartY, heartX, heartY + heartHeight / 4);
                    stripCtx.quadraticCurveTo(heartX, heartY + heartHeight / 2, heartX + heartWidth / 2, heartY + heartHeight * 0.85);
                    stripCtx.quadraticCurveTo(heartX + heartWidth, heartY + heartHeight / 2, heartX + heartWidth, heartY + heartHeight / 4);
                    stripCtx.quadraticCurveTo(heartX + heartWidth, heartY, heartX + heartWidth * 0.75, heartY);
                    stripCtx.quadraticCurveTo(heartX + heartWidth / 2, heartY, heartX + heartWidth / 2, heartY + heartHeight / 4);
                    stripCtx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                    stripCtx.fill();
                    stripCtx.stroke();
                    
                    stripCtx.restore();
                    
                    // Reset shadows and draw photo
                    stripCtx.shadowBlur = 0;
                    stripCtx.shadowOffsetX = 0;
                    stripCtx.shadowOffsetY = 0;
                    
                    // Draw photo with custom shape
                    stripCtx.save();
                    applyPhotoShape(x, y, photoWidth, photoHeight);
                    stripCtx.drawImage(img, x, y, photoWidth, photoHeight);
                    stripCtx.restore();
                    
                    // Add sticker
                    drawSticker(x, y, photoWidth, photoHeight, index);
                    
                    // Add decorative sparkles
                    stripCtx.fillStyle = '#ff69b4';
                    stripCtx.font = '20px Arial';
                    stripCtx.fillText('‚ú®', x - 15, y + 20);
                    stripCtx.fillText('‚ú®', x + photoWidth + 5, y + 20);
                });

                const footerY = startY + (photoHeight + photoPadding + 30) * 3 + 50;
                drawFooter(targetCanvas.width / 2, footerY);

            } else if (layout === 'layoutF') {
                // LAYOUT F: Classic photostrip (4 photos, simple black borders)
                // No header, just date at top
                stripCtx.fillStyle = '#ffffff';
                stripCtx.font = '14px Arial';
                stripCtx.textAlign = 'center';
                const date = new Date().toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                stripCtx.fillText(date, targetCanvas.width / 2, borderWidth + 30);
                
                const startY = borderWidth + 60;
                const photoSpacing = 10;
                
                loadedImages.slice(0, 4).forEach((img, index) => {
                    const y = startY + (index * (photoHeight + photoSpacing));
                    const x = borderWidth + padding;
                    
                    // Simple white frame
                    stripCtx.fillStyle = '#ffffff';
                    stripCtx.fillRect(x - 15, y - 15, photoWidth + 30, photoHeight + 30);
                    
                    // Draw photo with shape
                    stripCtx.save();
                    applyPhotoShape(x, y, photoWidth, photoHeight);
                    stripCtx.drawImage(img, x, y, photoWidth, photoHeight);
                    stripCtx.restore();
                    
                    // Add sticker
                    drawSticker(x, y, photoWidth, photoHeight, index);
                    
                    // Black border
                    stripCtx.strokeStyle = '#000000';
                    stripCtx.lineWidth = 3;
                    stripCtx.strokeRect(x, y, photoWidth, photoHeight);
                });

                // Footer at bottom
                stripCtx.fillStyle = '#ffffff';
                stripCtx.font = '12px Arial';
                stripCtx.textAlign = 'center';
                const footerY = startY + (photoHeight + photoSpacing) * 4 + 50;
                stripCtx.fillText('PhotoBooth Memories', targetCanvas.width / 2, footerY);
            }
        }

        // Customization event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Frame color selection
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    customOptions.frameColor = this.dataset.color;
                    updatePreview();
                });
            });

            // Photo shape selection
            document.querySelectorAll('.shape-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    customOptions.photoShape = this.dataset.shape;
                    updatePreview();
                });
            });

            // Sticker selection
            document.querySelectorAll('.sticker-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.sticker-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    customOptions.sticker = this.dataset.sticker;
                    updatePreview();
                });
            });

            // Logo selection
            document.querySelectorAll('.logo-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.logo-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    customOptions.logo = this.dataset.logo;
                    updatePreview();
                });
            });

            // Date checkbox
            document.getElementById('addDate')?.addEventListener('change', function() {
                customOptions.addDate = this.checked;
                updatePreview();
            });

            // Time checkbox
            document.getElementById('addTime')?.addEventListener('change', function() {
                customOptions.addTime = this.checked;
                updatePreview();
            });
        });

        async function updatePreview() {
            const previewCanvas = document.getElementById('previewCanvas');
            const layout = document.querySelector('input[name="layout"]:checked').value;
            await drawPhotoStripOnCanvas(previewCanvas, layout);
        }

        function retakePhotos() {
            // Hide customize and preview sections
            document.getElementById('customizeSection').classList.remove('active');
            document.getElementById('previewSection').classList.remove('active');
            
            // Reset photos
            resetPhotos();
            
            // Scroll back to camera
            document.getElementById('cameraSection').scrollIntoView({ behavior: 'smooth' });
        }

        async function downloadCustomized() {
            if (photos.length === 0) {
                showMessage('No photos to download!', 'error');
                return;
            }

            // Get selected layout
            const layout = document.querySelector('input[name="layout"]:checked').value;

            // Create a temporary canvas for download
            const downloadCanvas = document.createElement('canvas');
            
            // Draw the photo strip with current customizations
            await drawPhotoStripOnCanvas(downloadCanvas, layout);

            // Download
            setTimeout(() => {
                const link = document.createElement('a');
                link.download = `photobooth-${layout}-${Date.now()}.png`;
                link.href = downloadCanvas.toDataURL('image/png');
                link.click();
                showMessage(`Photo strip downloaded successfully! üíú`, 'success');
            }, 300);
        }

        async function downloadStrip() {
            if (photos.length === 0) {
                showMessage('No photos to download!', 'error');
                return;
            }

            // Get selected layout
            const layout = document.querySelector('input[name="layout"]:checked').value;

            // Create a temporary canvas for download
            const downloadCanvas = document.createElement('canvas');
            
            // Draw the photo strip and wait for it to complete
            await drawPhotoStripOnCanvas(downloadCanvas, layout);

            // Download
            setTimeout(() => {
                const link = document.createElement('a');
                link.download = `purple-photobooth-${layout}-${Date.now()}.png`;
                link.href = downloadCanvas.toDataURL('image/png');
                link.click();
                showMessage(`Purple photo strip (${layout}) downloaded successfully! üíú`, 'success');
            }, 300);
        }

        // Stop camera when page is closed
        window.addEventListener('beforeunload', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html>
